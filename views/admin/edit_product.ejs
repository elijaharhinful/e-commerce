<!DOCTYPE html>
<html>
<%- include('../partials/adminhead'); %>

<body class="main-layout">
    <%- include('../layouts/adminheader') %>
    <!-- Breadcrumb Section Begin -->
    <section class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__text">
                        <h4>Edit a product</h4>
                        <div class="breadcrumb__links">
                            <a href="/admin/products">Products</a>
                            <span>Edit product</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->
    <br>
    <br>

    <section>
        <div class="container">

            <div class="contact__form">
                <a href="/admin/products" class="btn btn-primary">Back to all products</a>
                <br><br>
                <h2>Add New Product</h2>
                <br>
                <form method="post" action="/admin/products/edit-product/<%= id %>" enctype="multipart/form-data">

                    <div class="form-group">
                        <label for="">Title</label>
                        <input type="text" class="form-control" name="title" value="<%= title %>" placeholder="Title">
                    </div>

                    <div class="form-group">
                        <label for="">Description</label>
                        <textarea name="desc" class="form-control" cols="30" rows="10"
                            placeholder="Description"><%= desc %></textarea>
                    </div>

                    <div class="form-group">
                        <label for="">Category</label>
                        <br>
                        <select name="category" class="form-control">
                            <% categories.forEach(function(cat){ %>
                            <option value="<%= cat.slug %>" <% if (cat.slug == category) { %> selected="selected"
                                <% } %>><%= cat.title %></option>
                            <% }); %>
                        </select>
                    </div>

                    <br><br>
                    <div class="form-group">
                        <label for="">Price</label>
                        <input type="text" class="form-control" name="price" value="<%= price %>" placeholder="Price">
                    </div>

                    <div class="form-group">
                        <label for="">Current Image</label>
                        <p>
                            <% if (image == "") { %>
                            <img id="noimage" src="/images/noimage.png" alt="">
                            <% } else {%>
                            <img id="noimage" src="/product_images/<%= id %>/<%= image %>" alt="">
                            <% } %>
                        </p>
                    </div>

                    <div class="form-group">
                        <label for="">Upload Image</label>
                        <input type="file" class="form-control" name="image" id="img">
                        <img src="#" id="imgPreview" alt="">
                    </div>

                    <input type="hidden" name="pimage" value="<%= image %>">
                    <button class="btn btn-primary">Save</button>
                </form>
            </div>
            <hr>
            

            <br><br>
            <div class="contact__form">
                <h3 class="page-header">Gallery</h3>

            <ul class="gallery">
                <% galleryImages.forEach(function(image){ %>
                <% if (image != "thumbs") { %>
                <li>
                    <img src="/product_images/<%= id %>/gallery/thumbs/<%= image %>" alt="">&nbsp;
                    <a class="confirmDeletion" href="/admin/products/delete-image/<%= image %>?id=<%= id %>">delete</a>
                </li>
                <% } %>
                <% }); %>
            </ul>
            <br><br>
                <form action="/admin/products/product-gallery/<%= id %>" method="post" enctype="multipart/form-data"
                    class="dropzone" id="dropzoneForm">
                    <div class="fallback">
                        <input type="file" name="file" multiple>
                        <input type="submit" value="Upload">
                    </div>
                </form>
            </div>
        </div>
    </section>
    <br>
    <br>

    <%- include('../layouts/adminfooter') %>
    <script>
        // Preview image
        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $("#imgPreview").attr('src', e.target.result).width(100).height(100);
                }

                reader.readAsDataURL(input.files[0]);
            }
        }

        $("#img").change(function () {
            readURL(this);
        });

        // Dropzone
        Dropzone.options.dropzoneForm = {
            acceptedFiles: "image/*",
            init: function () {
                this.on("queuecomplete", function (file) {
                    setTimeout(function () {
                        location.reload()
                    }, 1000);
                });
            }
        }
    </script>
</body>

</html>